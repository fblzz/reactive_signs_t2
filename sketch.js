let textContent = [
    "In 2025, the Museum für Gestaltung Zürich is celebrating the 150th anniversary of its founding. A banner year that presents the perfect occasion not only to take a look back at the history of the museum but also to examine current developments in the field of design and venture an outlook toward the future. A variety program of exhibitions and activities will take place throughout the anniversary year. One highlight is the grand opening in mid-April of the new permanent exhibition Swiss Design Collection at the Toni-Areal, accompanied by a whole weekend of festivities. In recent years, the Museum für Gestaltung Zürich has further strengthened its position as a leading museum of design and visual communication. With innovative exhibitions and interactive formats, it attracts a wide audience, promoting an ongoing dialogue on the latest trends and social issues in design. The museum explores design in all its diversity, presenting outstanding works to the public while also addressing today's digital transformation and fostering exchange and networking within the global design community. The museum places special emphasis on inclusion and sustainability and is committed to making its exhibitions and activities as broadly accessible and resource-efficient as possible. The diverse program is geared toward people of varied age groups and cultural backgrounds. In an effort to appeal to a broad international audience, the museum offers information and guided tours in several languages as well as simple German. On our 150th anniversary, we respectfully remember our past while looking confidently to the future. We want to continue to serve as a platform for innovative exhibitions, for safeguarding and preserving outstanding works, and for creative exchange. Our program endeavors to convey the enormous importance of design in a fun and exciting way so that as many people as possible can be inspired by good design, says Christian Brändle, director of the museum. The year kicks off with a special program at the museum's Ausstellungsstrasse location. The admission-free exhibition Jakob Kudsk Steensen: Berl-Berl turns the lecture hall into an immersive installation that will continually be reconfigured in real time by dedicated game engines. The unique 1933 building will be additionally enlivened in January by a range of activities for young and old, including behind-the-scenes architecture tours, design talks, workshops, one-off sales, a bar, a screen-printing studio, game events, and musical performances. Following this multifaceted prelude to the anniversary year, the new permanent exhibition Swiss Design Collection will open at the Toni-Areal in April. The exhibition presents highlights from the fields of graphic design, posters, the decorative arts, and industrial design that shed light on the collection from diverse and unexpected perspectives while also making parts of the archives accessible to the public for the first time. Visitors will be invited to exercise their own creativity based on various themes and using a number of different techniques. The exhibition opening on April 11 will mark the start of an anniversary weekend featuring free admission to both the new Swiss Design Collection presentation and the other exhibitions on view at the Toni-Areal and Ausstellungsstrasse locations. In July, the museum will then extend its reach into the public space with an exhibition by the lake devoted to 150 years of poster culture. Historical as well as contemporary examples will illustrate the development of poster art and its significance for visual communication. Viewers can look forward to embarking on a visual journey through the decades as they learn how posters still serve today as a mirror of society and a medium for artistic expression. The exploratory exhibition Museum of the Future – 17 Digital Experiments, which opens in August on Ausstellungsstrasse, takes a fascinating peek at the world of tomorrow, showing how digitalization and artificial intelligence are radically expanding what can be presented at the museum. Guests will have a chance to interact with digital artworks that blur the boundaries between physical and virtual reality. In the fall, the exhibition Young Graphic Design Switzerland! will look at contemporary work and how the youngest generation is shaping the graphic design landscape of tomorrow. Last but not least, the museum is putting together a show of the highs and lows from 150 years of posters advertising its own exhibitions. The Museum für Gestaltung Zürich looks back on an eventful history dating back to 1875, when it was founded as the City of Zurich's museum of applied arts. From 1898, the collection was housed in the National Museum. In 1933, the museum and the School of Arts and Crafts, founded 1878 and today known as Zurich University of the Arts (ZHdK), then relocated to the striking building on Ausstellungsstrasse, an outstanding example of New Building in Switzerland. From 1968 to 2014, the museum ran the Museum Bellerive on Lake Zurich, with a focus on decorative arts. In 2014, new exhibition spaces were opened on the new ZHdK campus in the Toni-Areal in Zurich-West, bringing together all four of the museum's collections and their 580,000 objects under one roof. Following extensive renovations, the original museum location on Ausstellungsstrasse was officially reopened in March 2018. Since May 2019, the museum has also been operating the Pavillon Le Corbusier for the public on behalf of the City of Zurich. Throughout the anniversary year, admission will be free on Thursday evenings from 5:00 to 8:00pm. In addition, starting with the opening of the new permanent exhibition Swiss Design Collection, visitors will be able to visit all three museum locations – Ausstellungsstrasse, the Toni-Areal, and the Pavillon Le Corbusier – with a new combined ticket. Admission is now free for young adults under the age of 20. The museum's collections represent an unparalleled treasure trove of design history, spanning centuries of creative innovation. From early examples of Swiss typography to contemporary digital design, the archives contain works by some of the most influential designers of their respective eras. The poster collection alone, with over 350,000 items, is one of the largest and most comprehensive in the world, documenting the evolution of visual communication from the late 19th century to the present day. Iconic works by designers such as Josef Müller-Brockmann, Emil Ruder, and Armin Hofmann form the backbone of what is known internationally as the Swiss Style, a design movement that emphasized clarity, readability, and objective communication. These pioneering designers worked closely with the museum and the School of Arts and Crafts, creating a symbiotic relationship between education, practice, and cultural preservation that continues to this day. The collection also includes significant holdings in product design, furniture, textiles, ceramics, and jewelry, reflecting the breadth of applied arts and industrial design. Notable pieces include early modernist furniture by Le Corbusier, Charlotte Perriand, and Marcel Breuer, as well as innovative product designs from the mid-20th century that transformed everyday life. The textile collection features everything from historical samples of Swiss embroidery and weaving to experimental fabric designs from contemporary artists pushing the boundaries of material innovation. Throughout its history, the museum has been committed to making design accessible and understandable to the broader public. Educational programs for schools, families, and adult learners have been a cornerstone of the museum's mission, helping to cultivate visual literacy and an appreciation for good design across generations. Workshops, lectures, and guided tours provide opportunities for visitors to engage more deeply with the exhibitions and to develop their own creative skills. The museum's library and study center serve as important resources for researchers, students, and design professionals, offering access to an extensive collection of books, periodicals, and archival materials related to design history and theory. The anniversary year provides a unique opportunity to reflect on the evolving role of design in society and to consider how museums can remain relevant in an increasingly digital world. The exhibition Museum of the Future – 17 Digital Experiments directly addresses these questions by showcasing innovative approaches to curation, display, and visitor engagement. From virtual reality experiences to AI-generated exhibitions, these experiments explore how technology can enhance rather than replace the physical museum experience. Interactive installations allow visitors to participate in the creative process, while digital archives make it possible to explore the full breadth of the collection in ways that would be impossible in a traditional exhibition setting. The museum has also embraced social media and digital platforms as tools for reaching new audiences and fostering dialogue around design issues. Online exhibitions, virtual tours, and digital workshops have expanded the museum's reach far beyond the borders of Zurich, connecting with design enthusiasts and professionals around the globe. This digital engagement complements rather than competes with the physical museum experience, offering multiple entry points for people to connect with design culture. As we look toward the future, the Museum für Gestaltung Zürich remains committed to its founding mission of promoting excellence in design and making it accessible to all. The challenges facing the world today – from climate change to social inequality to rapid technological transformation – require innovative design solutions, and museums have an important role to play in fostering the creative thinking and visual literacy needed to address these challenges. By preserving and presenting the best examples of design from the past, while also championing experimental and forward-thinking work, the museum helps to inspire the next generation of designers and design-conscious citizens. The anniversary celebrations will culminate in a major symposium bringing together leading designers, curators, educators, and theorists from around the world to discuss the future of design museums and the role of design in shaping a more sustainable and equitable future. This gathering will provide an opportunity to share best practices, explore new models for museum programming and collection development, and to strengthen international networks within the design community. The insights and connections generated through this symposium will help guide the museum's strategic direction for the next chapter of its history. In addition to the exhibitions and events taking place at the museum's three locations, the anniversary year will see numerous collaborations with other cultural institutions, educational organizations, and community groups throughout Zurich and beyond. These partnerships reflect the museum's commitment to being an active participant in the cultural life of the city and to making design a part of everyday conversation. Pop-up exhibitions, design interventions in public spaces, and collaborative projects with local schools and community centers will bring design to new audiences and demonstrate its relevance to daily life. The Museum für Gestaltung Zürich has always been more than just a repository for beautiful objects. It is a living institution that actively shapes design discourse and practice through its exhibitions, publications, and educational programs. The museum's staff includes curators, conservators, educators, and researchers who are experts in their respective fields and who contribute to international scholarship on design history and theory. Their work ensures that the collection is not only preserved for future generations but also studied, interpreted, and made relevant to contemporary concerns. The anniversary year is also an opportunity to recognize the many individuals who have contributed to the museum's success over the past 150 years. From the visionary founders who established the institution to the dedicated staff members who have worked behind the scenes to care for the collection, countless people have played a role in building the museum into what it is today. Special recognition is due to the donors, sponsors, and supporters who have provided crucial financial backing and whose generosity has made possible many of the museum's most ambitious projects. Their continued support will be essential as the museum embarks on its next 150 years. As part of the anniversary celebrations, the museum is launching several new initiatives designed to ensure its long-term sustainability and continued relevance. These include an expanded membership program offering exclusive benefits and behind-the-scenes access, a new fellowship program for emerging curators and researchers, and enhanced conservation facilities to ensure the proper care of the collection for future generations. The museum is also exploring innovative funding models and partnerships that will provide financial stability while maintaining its commitment to accessibility and public service. Looking back over 150 years of history, it is remarkable to see how the Museum für Gestaltung Zürich has evolved and adapted to changing times while remaining true to its core mission. From its origins as a teaching collection supporting the applied arts to its current status as an internationally recognized institution at the forefront of design discourse, the museum has consistently demonstrated the ability to innovate and respond to new challenges. As we celebrate this milestone, we also look forward with excitement and confidence to the future, knowing that design will continue to play a crucial role in shaping our world and that the Museum für Gestaltung Zürich will continue to be a leader in promoting and preserving design excellence for generations to come."
];

let words = [];
let currentNumber = -1;
let previousNumber = -1;
let transitionProgress = 0;
let isTransitioning = false;
let transitionDuration = 500;

let currentMask, nextMask;
let currentPixels, nextPixels;

let countdownValue = 9; // Startwert des Countdowns

function setup() {
    createCanvas(windowWidth, windowHeight);
    pixelDensity(1);
    frameRate(60);

    // Lokaler Fallback mit echtem Countdown
    window.poster = {
        getCounter: () => countdownValue,
        vw: width / 100
    };

    // Jede Sekunde runterzählen
    setInterval(() => {
        countdownValue--;
        if (countdownValue < 0) countdownValue = 9; // Loop bei 9
    }, 1000);

    currentNumber = poster.getCounter();
    previousNumber = currentNumber;

    parseText();
    createNumberMasks();
}

function draw() {
    background(0);

    let newNumber = poster.getCounter();
    if (newNumber !== currentNumber && !isTransitioning) {
        previousNumber = currentNumber;
        currentNumber = newNumber;
        isTransitioning = true;
        transitionProgress = 0;

        updateNumberMask(previousNumber, nextMask, false);
        updateNumberMask(currentNumber, currentMask, true);

        words.forEach(word => {
            word.targetOffsetX = random(-8 * poster.vw, 8 * poster.vw);
        });
    }

    if (isTransitioning) {
        transitionProgress += deltaTime / transitionDuration;

        if (transitionProgress >= 1) {
            isTransitioning = false;
            transitionProgress = 0;

            words.forEach(word => {
                word.offsetX = 0;
                word.offsetY = 0;
                word.targetOffsetX = 0;
            });
        } else {
            words.forEach(word => {
                if (transitionProgress < 0.5) {
                    let t = transitionProgress * 2;
                    let eased = easeInOutCubic(t);
                    word.offsetX = word.targetOffsetX * eased;
                } else {
                    let t = (transitionProgress - 0.5) * 2;
                    let eased = easeInOutCubic(t);
                    word.offsetX = word.targetOffsetX * (1 - eased);
                }
            });
        }
    }

    let fontSize = 1.8 * poster.vw;
    textFont('Times New Roman');
    textSize(fontSize);
    textAlign(LEFT, BASELINE);
    noStroke();

    words.forEach(word => {
        let drawX = word.baseX + word.offsetX;
        let drawY = word.baseY + word.offsetY;

        let overlapsNext = false;
        let overlapsCurrent = false;

        if (isTransitioning) {
            overlapsCurrent = checkOverlapFast(word, drawX, drawY, currentPixels, fontSize);
            overlapsNext = checkOverlapFast(word, drawX, drawY, nextPixels, fontSize);

            if (overlapsCurrent || overlapsNext) {
                let currentAlpha = overlapsCurrent ? (1 - transitionProgress) : 0;
                let nextAlpha = overlapsNext ? transitionProgress : 0;
                let combinedAlpha = Math.max(currentAlpha, nextAlpha);
                combinedAlpha = Math.min(1, combinedAlpha + 0.3);

                fill(255, 255, 255, 255 * combinedAlpha);
            } else {
                fill(60, 60, 60);
            }
        } else {
            overlapsCurrent = checkOverlapFast(word, drawX, drawY, currentPixels, fontSize);
            if (overlapsCurrent) {
                fill(255);
            } else {
                fill(60, 60, 60);
            }
        }

        text(word.text, drawX, drawY);
    });
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);

    // poster.vw neu berechnen
    poster.vw = width / 100;

    parseText();
    createNumberMasks();
}

function parseText() {
    words = [];

    let margin = 4 * poster.vw;
    let fontSize = 1.8 * poster.vw;
    let lineHeight = fontSize;

    let y = margin + fontSize;
    let maxWidth = width - margin * 2;

    textFont('Times New Roman');
    textSize(fontSize);

    let allText = textContent.join(' ');
    let allWords = allText.split(' ');

    let currentLine = [];
    let currentLineWidth = 0;

    allWords.forEach((word, index) => {
        let w = textWidth(word + ' ');

        if (currentLineWidth + w > maxWidth && currentLine.length > 0) {
            justifyLine(currentLine, margin, y, maxWidth, fontSize, index === allWords.length - 1);
            currentLine = [word];
            currentLineWidth = w;
            y += lineHeight;
        } else {
            currentLine.push(word);
            currentLineWidth += w;
        }
    });

    if (currentLine.length > 0) {
        let xPos = margin;
        textSize(fontSize);
        currentLine.forEach(word => {
            let w = textWidth(word + ' ');
            words.push({
                text: word,
                x: xPos,
                y: y,
                w: w,
                baseX: xPos,
                baseY: y,
                offsetX: 0,
                offsetY: 0,
                targetOffsetX: 0
            });
            xPos += w;
        });
    }
}

function justifyLine(lineWords, startX, yPos, maxWidth, fontSize, isLastLine) {
    if (lineWords.length === 0) return;

    textFont('Times New Roman');
    textSize(fontSize);

    let totalWordWidth = 0;
    lineWords.forEach(word => {
        totalWordWidth += textWidth(word);
    });

    let totalSpace = maxWidth - totalWordWidth;
    let spaceCount = lineWords.length - 1;
    let spaceWidth = spaceCount > 0 ? totalSpace / spaceCount : 0;

    if (isLastLine || lineWords.length === 1) {
        spaceWidth = textWidth(' ');
    }

    let x = startX;
    lineWords.forEach(word => {
        let w = textWidth(word);
        words.push({
            text: word,
            x: x,
            y: yPos,
            w: w,
            baseX: x,
            baseY: yPos,
            offsetX: 0,
            offsetY: 0,
            targetOffsetX: 0
        });
        x += w + spaceWidth;
    });
}

function createNumberMasks() {
    if (currentMask) currentMask.remove();
    currentMask = createGraphics(width, height);
    currentMask.pixelDensity(1);
    currentMask.textFont('Helvetica');
    currentMask.textSize(height * 0.85);
    currentMask.textAlign(CENTER, CENTER);
    currentMask.fill(255);
    currentMask.text(currentNumber.toString(), width / 2, height / 2);
    currentMask.loadPixels();
    currentPixels = currentMask.pixels;

    if (nextMask) nextMask.remove();
    nextMask = createGraphics(width, height);
    nextMask.pixelDensity(1);
    nextMask.textFont('Helvetica');
    nextMask.textSize(height * 0.85);
    nextMask.textAlign(CENTER, CENTER);
    nextMask.fill(255);
    nextMask.text(previousNumber.toString(), width / 2, height / 2);
    nextMask.loadPixels();
    nextPixels = nextMask.pixels;
}

function updateNumberMask(num, mask, isCurrentMask) {
    if (!mask) return; // Sicherheitsnetz

    mask.clear();
    mask.textFont('Helvetica');
    mask.textSize(height * 0.85);
    mask.textAlign(CENTER, CENTER);
    mask.fill(255);
    mask.text(num.toString(), width / 2, height / 2);
    mask.loadPixels();

    if (isCurrentMask) {
        currentPixels = mask.pixels;
    } else {
        nextPixels = mask.pixels;
    }
}

function easeInOutCubic(t) {
    return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

function checkOverlapFast(word, drawX, drawY, pixels, fontSize) {
    if (!pixels) return false;

    let wordHeight = fontSize;
    let samples = 4;

    for (let i = 0; i < samples; i++) {
        let sampleX = Math.floor(drawX + (word.w * i / samples));
        let sampleY = Math.floor(drawY - wordHeight / 2);

        for (let j = 0; j < 2; j++) {
            let checkY = Math.floor(sampleY + (wordHeight * j));

            if (sampleX >= 0 && sampleX < width && checkY >= 0 && checkY < height) {
                let idx = (checkY * width + sampleX) * 4;
                if (pixels[idx] > 128) {
                    return true;
                }
            }
        }
    }
    return false;
}